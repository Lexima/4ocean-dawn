
{%- style -%}



{%- endstyle -%}

{% javascript %}

class StickyProduct extends HTMLElement {
    constructor() {
        super();

    }

    connectedCallback() {
        this.target = document.querySelector('.product')
        this.header = document.querySelector('sticky-header');
        this.headerBounds = {};
        this.onScrollHandler = this.onScroll.bind(this);


        window.addEventListener('scroll', this.onScrollHandler, false);
        this.createObserver();


    }

    createObserver() {
        let observer = new IntersectionObserver((entries, observer) => {
            const scrollTop = window.pageYOffset;
            
            if (entries[0].isIntersecting) {
                this.hide();
            } else if (scrollTop > 130)  {
                this.show();
            }
            //observer.disconnect();
        },{
            threshold: 0.5
        });
        
        //observer.observe(this.header);
        observer.observe(this.target);
      }

    onScroll() {
        const scrollTop = window.pageYOffset;

        if (scrollTop < 130) {
            requestAnimationFrame(this.hide.bind(this));
        }
    }

    hide() {
        this.classList.add('hide');
    }

    show() {
        this.classList.remove('hide'); 
    }
}

customElements.define('sticky-product', StickyProduct);





{% endjavascript %}

<sticky-product class="hide">
    {%- render 'product-banner', show_price: section.settings.show_price, fixed: true -%}
</sticky-product>


{% schema %}

{
    "name": "Sticky product",
    "tag": "section",
    "class": "section",
    "settings": [
        {
            "type": "checkbox",
            "id": "show_price",
            "default": true,
            "label": "Show price"
        }
    ],
    "presets": [
        {
            "name": "Sticky Product"
        }
    ]
}

{% endschema %}
